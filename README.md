Описание прошивки
=================

Прошивка для управления вентилятором, при помощи ESP32. 

У вентилятора есть три выхода для управления скоростью. Каждый из которых переключает на одну из 3х скоростей.
Один из пинов предназначен для фиксирующей кнопки. Этой кнопкой можно принудительно переключить устройство, как точку доступа WiFi.

Общие возможности
-----------------
* Есть подробное информирование в терминале. 
* У прошивки развитый Веб-интерфейс доступный по адресу http://fanmanager.local
* Прошивка умеет интегрироваться с Home Assistant. 
* Возможность модификации Веб-составляющей без перепрошивки.
* Адаптация веб-интерфейса под мобильное устройство

Описание веб-интерфеса
----------------------
Имеется 5 вкаладок (первая открывается при клики на заголовок сайта "Управление вентилятором"). В конце страницы на всех вкладках, есть сводная информация об устройстве.

__Вкладки__
* `Управление вентилятором` -- На этой вкладке ползунок управляющий скоростью вращения вентилятора. В крайнем левом положении вентилятор выключен. И дополнительные 3 положения для управления скоростью вращения вентилятором. При смене положения на одну из 3х ножек подается низкий уровень сигнала, на остальные высокий. В крайнем левом положении на всех 3х пинах высокий уровень.
* `Вкладка "Подключение"`-- На этой вкладке можно задать параметры подключения к WiFi роутеру. При нажатии кнопки "Сохранить" будет произведена попытка подключения к WiFi роутеру с заданными параметрами. 

   Если попытка закончится неудачей, то точка доступа с именем __fanmanager__ будет создана заново. При этом доступ к веб-интерфейсу станет снова доступен только по IP-адресу 192.168.4.1. 

   Если подключение к WiFi роутеру будет успешно, доступ к веб-интерфейсу станет снова доступен по IP-адресу который выдаст роутер или по адресу http://fanmanager.local
*  `Вкладка "Home Assistant"` -- позволяет настроить подключение к MQTT-брокеру, для добавления устройства к __Home Assistant__. На этой вкладке 7 элементов управления, включая кнопку и 2-х неактивных элемента: *Название устройства*, *Название модуля*. Их невозможно изменить, они носят только информационный характер. Доступ к элементам: *Сервер HA (MQTT) - IP*, *Логин*, *Пароль*, - станет доступен только после разрешения флажка: *Включить доступ к Home Assistant*. При выключенном флажке подключение к MQTT-брокеру не осуществляется.
  
   `Элемент управления "Сервер HA (MQTT) - IP"` -- требует указать IP-адрес MQTT-брокера, с которым настроено взаимодействие Home Assistant. Возможна так же работа с MQTT-пакетами из других приложений. *(В этом поле возможно указание только IP-адреса, DNS имя не будет распознано)*

   `Элемент управления "Логин"`-- требуется указать логин под которым будет осуществлено подключение к MQTT-брокеру.

   `Элемент управления "Пароль"`-- требуется указать пароль под которым будет осуществлено подключение к MQTT-брокеру.

   `Элемент управления кнопка "Сохранить"` -- Кроме непосредственно функции сохранения, так же может сигнализировать об успешности подключения к MQTT-брокеру. Красный цвет сигнализирует о провале, зеленый об успешном подключении. Также, можно увидеть состояние подключения в внизу страницы в сводной информации об устройстве, параметр **"Подключение к HA"**.

*  `Вкладка "Пины"` -- позволяет задать номер пинов на ESP32 через которые будет осуществляться управление скоростью вентилятора. Так же на этой вкладке можно задать номер пина для навешивания кнопку переключения режима WiFi: подключение к роутеру, или точка доступа. *(Хочу обратить внимание не все пины доступны на вход и выход. Читайте документацию по ESP32. Для удобства, внизу страницы есть картинка с распиновкой ESP32 DevKit V1)*.
  
*  `Вкладка "Файлы"` -- На этой вкладке возможно управление и тонкой настройки веб-интерфейса, без перепрошивки. Доступны элементы управления: *Обновление списка файлов* (в обычном случае производиться в автоматическом режиме, но мало ли?!); *Добавление файла* - есть возможность задание имени файла по которым он будет сохранен в устройстве, в том числе и задание папок; *Удаление файла* - будьте осторожны при удалении, возможна потеря доступа к веб-интерфейсу. Есть возможность доступа как htm-расширению, так и html-расширению. Эту возможность можно использовать при модификации важных файлов.
  
Прошивка устройства
-------------------

Прошивка может быть осуществлена или в среде разработки **PlatformIO**, или при помощи утилиты esptool. Необходимые файлы для будут приложены отдельно в разделе: **Releases**